/*
 * knockout-simple-validation v1.0.1 - 2015-05-09
 * Copyright (c) 2015 Binar Tecnologia;
 */
!function(a){"use strict";var b=this||(0,eval)("this");if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module){var c=module.exports||exports;a(c,require("jquery"),require("knockout"),require("moment"))}else"function"==typeof define&&define.amd?define(["exports","jquery","knockout","moment"],a):a(b.ksv={},jQuery,ko,moment)}(function(exports,$,ko,moment){"use strict";var ksv="undefined"!=typeof exports?exports:{};ksv.settings=function(){return{lang:"en",applyInvalidValue:!1,validationOnInit:!1,getLang:function(){var a=ksv.settings.lang;return"function"==typeof a&&(a=a()),a},dateFormat:"DD/MM/YYYY"}}(),ksv.utils={debug:function(a){ksv.utils.debug.enable&&console.log(a)},isObject:function(a){return"object"==typeof a},get:function(a,b){if(!a||!ksv.utils.isObject(a))return void 0;for(var c=b.split("."),d=a,e=0;e<c.length;e++){var f=c[e];if(!d.hasOwnProperty(f))return void 0;if(d=d[f],null===d||void 0===d)return void 0}return d},exists:function(a,b){if(ksv.utils.isObject(a)){var c=ksv.utils.get(a,b);return void 0!==c}return!1}},ksv.utils.debug.enable=!1,ksv.notification=function(){function a(a){this.obj=a}var b=[];return a.prototype.validatable=function(){var a,b,c;"string"==typeof arguments[0]?(b=arguments[0],a=arguments[1],c=arguments[2]):(a=arguments[0],c=arguments[1]);var d=Object.create(a);return d.hasOwnProperty("params")||(d.params={}),d.params.owner=this.obj,b&&(d.params.name=b),ko.observable(c).extend({validator:d})},{subscribe:function(a,c){var d={fn:a};return c&&(d.owner=c),b.push(d),d},unsubscribe:function(a){b.pop(a)},observeValidations:function(a){return a.__validationObserver__=ko.observableArray([]),a.__validationObserver__},makeObservable:function(b,c){return b.validationParams=c,b.errors=ksv.notification.observeValidations(b),b.isValidationInitialized=ko.observable(!1),b.isValid=ko.pureComputed(function(){return b.isValidationInitialized()?0===b.errors().length:!1},b),new a(b)},notify:function(a,c,d,e,f,g,h){if(c&&"function"==typeof c.validationNotification&&c.validationNotification.call(c,a,d,e,f,g,h),c&&ko.isObservable(c.isValidationInitialized)&&c.isValidationInitialized(!0),c&&ko.isObservable(c.__validationObserver__)){var i=c.__validationObserver__;if(f)i.remove(function(a){return a.instanceId===e});else{for(var j=!1,k=i(),l=0;l<k.length;l++){var m=k[l];if(m.instanceId===e){j=!0;break}}j||i.push({instanceId:e,rule:d,owner:c,target:a,name:h,message:g})}}for(var n=0;n<b.length;n++){var o=b[n];"owner"in o?o.owner==c&&o.fn(a,c,d,e,f,g,h):o.fn(a,c,d,e,f,g,h)}}}}(),ksv.rules=function(notification,utils){function resolveVars(message,context){for(var lang=context.lang,value=context.value,params=context.params,data=context.data,result=[],inVar=!1,varName=[],oldChar=null,i=0;i<message.length;i++){var chr=message.charAt(i);"{"===chr&&"$"===oldChar?inVar=!0:"}"===chr?(result.pop(),result.push(eval(varName.join(""))),varName=[],inVar=!1):inVar?varName.push(chr):result.push(chr),oldChar=chr}return result.join("")}function getMessagesForRule(a,b){return utils.debug("getting messages for rule "+a+" and lang "+b),utils.debug("messages: "+JSON.stringify(messages)),messages[b]?messages[b][a]:messages["default"]&&messages["default"][a]}function resolveMessageFromObject(a,b,c){utils.debug("resolving message from object. variation: "+b+", messages: "+JSON.stringify(a));var d=utils.get(a,b);return d?resolveVars(d,c):void 0}function evalMessage(a,b,c,d,e,f,g){var h={lang:c,value:e,params:f,data:g};switch(typeof a){case"string":return resolveVars(a,h);case"function":return a(c,d,e,f,g);case"object":return resolveMessageFromObject(a,d,h)}return void 0}function resolveMessage(a,b,c,d,e,f,g){if(b.messageResolve)return b.messageResolve(a,b,c,d,e,f,g);if(utils.debug("resolve message for rule "+a+". lang: "+c+", variation: "+d),utils.exists(f,"message")){utils.debug("using message from validation parameters");var h=f.message,i=getMessagesForRule(a,c);return utils.isObject(h)&&utils.isObject(i)&&(h=$.extend(!0,{},i,h)),utils.isObject(h)&&utils.isObject(b.defaultMessage)&&(h=$.extend(!0,{},b.defaultMessage,h)),evalMessage(h,a,c,d,e,f,g)}var j=evalMessage(getMessagesForRule(a,c),a,c,d,e,f,g);return j?utils.debug("using message from registered messages"):(utils.debug("using default message: "+JSON.stringify(b.defaultMessage)),j=evalMessage(b.defaultMessage,a,c,d,e,f,g)),utils.debug("resolved message "+j),j}function ValidationRuleExecutor(a,b,c,d,e){utils.debug("creating validation executor for rule "+a+" with params. settings: "+JSON.stringify(b)+", params: "+JSON.stringify(c)),this.instanceId=uniqueId(),this.ruleName=a,this.settings=b,this.params=c,this.target=d,this.validatorExecutor=e,this.forceValidation=function(){this.validatorExecutor.validate(this.target())},this.getParam=function(a){return this.params[a]},this.getParamOrThrow=function(b){if(!this.params.hasOwnProperty(b))throw new Error("Parameter "+b+" not found in rule "+a);return this.params[b]},this.validate=function(b){utils.debug("executing validation rule "+this.ruleName+" whith params. value: "+b+", settings: "+JSON.stringify(this.settings));var c=this.settings.rule.call(this,b);return utils.debug("validation rule "+a+" result: "+JSON.stringify(c)),c},this.asyncValidate=function(a,b){return this.settings.rule.call(this,a,b)},this.settings.init&&this.settings.init.call(this)}function ValidatorExecutor(a,b){function c(a,b){a.__validatorCreated__=!0,a.isValidatable=function(){return!0},a.validator=b}var d=this;this.target=a,this.options=b,this.params=b.params;var e=[],f=utils.get(this.params,"applyInvalidValue"),g=utils.get(this.params,"validationOnInit");if(void 0===g&&this.params&&this.params.owner&&this.params.owner.validationParams&&(g=this.params.owner.validationParams.validationOnInit),void 0!==a.__validatorCreated__)throw new Error("Nested valitador not allowed. One validator already created by this observable, to add more validation rules, use addRule from validator instance in observable");c(a,this),this.addRule=function(b,c){var d=rules[b];if(!d)throw new Error("Rule "+b+" not found");utils.isObject(c)&&c.constructor!==Date||(c={value:c}),void 0===f&&void 0!==c.applyInvalidValue&&(f=c.applyInvalidValue),void 0===g&&void 0!==c.validationOnInit&&(g=c.validationOnInit),$.extend(!0,c,this.params);var h=new ValidationRuleExecutor(b,d.settings,c,a,this);e.push(h)};for(var h in b)if("params"!==h){var i=h,j=b[h];if("function"!=typeof j||rules[i])this.addRule(i,j);else{var k={rule:j},l=$.extend(!0,{},this.params),m=new ValidationRuleExecutor(i,k,l,a,this);e.push(m)}}f=f||ksv.settings.applyInvalidValue,g=g||ksv.settings.validationOnInit;var n=ko.observable(!1),o=ko.observable(null);this.applyValidationResult=function(b,c,d){var e,f,g,h,i=ksv.settings.getLang(),j=b.ruleName,k=b.settings,l=b.params,m=l.owner,p=b.instanceId;return utils.isObject(d)?(e=d.valid,f=d.variation,h=d.data,g=d.message):e=d,e?(n(!0),o(null)):(g=g?evalMessage(g,j,i,f,c,l,h):resolveMessage(j,k,i,f,c,l,h),n(!1),o(g)),utils.debug("notify validation for rule "+j+". valid: "+e+", message: "+g+", name: "+l.name),notification.notify(a,m,j,p,e,g,l.name),e},this.validate=function(b){function c(a){return function(c){d.applyValidationResult(a,b,c)}}function g(a){return function(c){h=d.applyValidationResult(a,b,c)}}for(var h=!1,i=0;i<e.length;i++){var j=e[i];if(j.settings.async)void 0===j.params.async||j.params.async?h=j.asyncValidate(b,c(j)):j.asyncValidate(b,g(j));else{var k=j.validate(b);if(h=this.applyValidationResult(j,b,k),!h)break}}(f||h)&&a(b),h&&(n(!0),o(null))},this.targetWrapper=ko.pureComputed({read:a,write:function(a){this.validate(a)}},this),this.targetWrapper.isValid=n,this.targetWrapper.error=o,this.targetWrapper.validate=function(){return d.validate(a()),this},g&&this.targetWrapper(a()),c(this.targetWrapper,this)}var rules={},messages={},uniqueId=function(){var a=0;return function(){return++a}}();return ko.extenders.validator=function(a,b){var c=new ValidatorExecutor(a,b);return c.targetWrapper},{register:function(a,b){var c=rules[a];if(void 0!==c&&!c.settings.override)throw new Error("The rule "+a+" can not be overridden");if(!a||"string"!=typeof a)throw new Error("Invalid rule name");if("function"==typeof b)throw new Error("Invalid settings for rule. Expected object but found "+typeof b);if(!("rule"in b)||"function"!=typeof b.rule)throw new Error("Invalid value for rule property. Rule name: "+a);if("init"in b&&"function"!=typeof b.init)throw new Error("Invalid value for init property. Rule name: "+a);if(!("defaultMessage"in b))throw new Error("Property defaultMessage not found");if("defaultMessage"in b&&"string"!=typeof b.defaultMessage&&"function"!=typeof b.defaultMessage&&!utils.isObject(b.defaultMessage))throw new Error("Invalid value for defaultMessage property. Rule name: "+a);if("messageResolve"in b&&"function"!=typeof b.messageResolve)throw new Error("Invalid value for messageResolve property. Rule name: "+a);if("override"in b||(b.override=!0),"override"in b&&"boolean"!=typeof b.override)throw new Error("Invalid value for override property. Rule name: "+a);if("async"in b||(b.async=!1),"async"in b&&"boolean"!=typeof b.async)throw new Error("Invalid value for async property. Rule name: "+a);utils.debug("registring rule "+a+", settings: "+JSON.stringify(b)),rules[a]={name:a,settings:b}},registerMessage:function(a,b,c){c||(c="default"),messages[c]||(messages[c]={}),"string"==typeof b?messages[c][a]=b:$.extend(!0,messages[c][a],b),utils.debug("registered message for rule "+a+", message: "+b+", lang: "+c),utils.debug("messages after register "+JSON.stringify(messages))},registerMessages:function(a,b){if(!utils.isObject(a))throw new Error("New messages should be an object instance");b||(b="default"),messages[b]||(messages[b]={}),$.extend(!0,messages[b],a)}}}(ksv.notification,ksv.utils),ksv.builtin=function(a){var b={required:{rule:function(a){return"string"==typeof a?!!a.trim():void 0!=a},defaultMessage:"This field is required."},email:{rule:function(a){return"string"!=typeof a?!1:a?/[\w.%+-]{2,}@[\w.-]{2,}.[\w]{2,4}[.]*[\w]*?/g.test(a):!0},defaultMessage:"Please enter a proper email address."},url:{rule:function(a){return"string"!=typeof a?!1:a?/^(http|https)\:\/\/[\w%-]+[.]{1}[:]*[/]*[\w.?#-]*?/g.test(a):!0},defaultMessage:"Please enter a proper URL."},nativeDate:{rule:function(a){return void 0===a?!0:a.constructor!==Date?!1:!0},defaultMessage:"Please enter a proper date."},date:{rule:function(b){var c=this.params;if(void 0==b)return!0;if("string"!=typeof b)return{valid:!1,variation:"type"};var d=c.format||ksv.settings.dateFormat,e=moment(b,d,!0);if(!e.isValid())return{valid:!1,variation:"type"};var f=e.toDate();if(a.exists(c,"min")){var g=c.min;if(g>f)return{valid:!1,variation:"min"}}if(a.exists(c,"max")){var h=c.max;if(f>h)return{valid:!1,variation:"max"}}return!0},defaultMessage:{type:"Please enter a proper date.",min:"Please enter a value greater than or equal to ${params.min}",max:"Please enter a value less than or equal to ${params.max}"}},number:{rule:function(a){return void 0==a?!0:"number"!=typeof a?!1:!0},defaultMessage:"Please enter a number."},integer:{rule:function(a){if(void 0==a)return!0;if("number"!=typeof a)return!1;var b=a.toString(),c=b.indexOf(".");-1===c&&(c=b.length);var d=parseFloat(b.substring(0,c)),e=a%d;return e>0?!1:!0},defaultMessage:"Please enter a valid integer number."},max:{rule:function(a){{var b=this.params;this.settings}if(void 0==a)return!0;if("number"!=typeof a&&a.constructor!==Date)return{valid:!1,variation:"type"};var c=b.value;return a>c?{valid:!1,variation:"max"}:!0},defaultMessage:{type:"The max validator can be only used with number and date values",max:"Please enter a value less than or equal to ${params.value}"}},min:{rule:function(a){var b=this.params;if(void 0==a)return!0;if("number"!=typeof a&&a.constructor!==Date)return{valid:!1,variation:"type"};var c=b.value;return c>a?{valid:!1,variation:"min"}:!0},defaultMessage:{type:"The min validator can be only used with number and date values",min:"Please enter a value greater than or equal to ${params.value}"}},maxlength:{rule:function(a){var b=this.params;return void 0==a?!0:"string"!=typeof a?{valid:!1,variation:"type"}:a.trim().length>b.value?{valid:!1,variation:"maxlength"}:!0},defaultMessage:{type:"The maxlength validator can be only used with number and date values",maxlength:"Please enter no more than ${params.value} characters."}},minlength:{rule:function(a){var b=this.params;return void 0==a?!0:"string"!=typeof a?{valid:!1,variation:"type"}:a.trim().length<b.value?{valid:!1,variation:"minlength"}:!0},defaultMessage:{type:"The minlength validator can be only used with number and date values",minlength:"Please enter at least ${params.value} characters."}},rangelength:{rule:function(b){var c=this.params;if(void 0==b)return!0;if("string"!=typeof b)return{valid:!1,variation:"type"};var d=a.exists(c,"min")?c.min:-1,e=a.exists(c,"max")?c.max:-1;return d>-1&&b.trim().length<d?{valid:!1,variation:"min"}:e>-1&&b.trim().length>e?{valid:!1,variation:"max"}:!0},defaultMessage:{type:"The rangelength validator can be only used with number and date values",min:"Please enter at least ${params.min} characters.",max:"Please enter no more than ${params.max} characters."}},equalsTo:{init:function(){var b=this;if(this.other=this.getParamOrThrow("other"),this.otherName=this.getParamOrThrow("otherName"),this.validateUninitialized=this.params.validateUninitialized||!1,void 0==this.other)throw new Error("The other parameter not found");if("function"!=typeof this.other)throw new Error("The other parameter should be a function");if("string"!=typeof this.otherName||!this.otherName)throw new Error("The otherName parameter invalid");ko.isObservable(this.other)&&this.other.subscribe(function(){var c=void 0!=b.target()||void 0==b.target()&&b.validateUninitialized;a.debug("other changed. force validation: "+c),c&&b.forceValidation()})},rule:function(a){return a===this.other()},defaultMessage:"Values must be equal to ${params.otherName}"},remote:{init:function(){if(this.ident=this.params.ident,void 0==this.ident||""===this.ident)throw new Error("The ident parameter not found");if("string"!=typeof this.ident)throw new Error("The ident parameter should be a string");if(this.url=this.params.url,void 0==this.url||""===this.url)throw new Error("The url parameter not found");if("string"!=typeof this.ident&&"function"!=typeof this.ident)throw new Error("The url parameter should be a string or a function");if(this.async=void 0!==this.params.async?this.params.async:!0,this.prepValidationData=this.params.prepValidationData,this.prepValidationData&&"function"!=typeof this.prepValidationData)throw new Error("The prepValidationData parameter should be a function");if(this.checkResult=this.params.checkResult,this.checkResult&&"function"!=typeof this.checkResult)throw new Error("The checkResult parameter should be a function")},rule:function(a,b){var c=this,d=this.url;"function"==typeof d&&(d=d.call(this,a));var e={};if(e[this.ident]=a,this.prepValidationData){var f=this.prepValidationData.call(this,a,e);f&&(e=f)}return e=JSON.stringify(e),$.ajax({url:d,async:this.async,type:"POST",data:e,dataType:"json",contentType:"application/json",cache:!1,complete:function(d){var e,f=d.status,g={};d.responseText&&(g=$.parseJSON(d.responseText)),c.checkResult?e=c.checkResult(a,f,g):200===f?e=!0:(e={},e.valid=!1,"message"in g&&(e.message=g.message)),b(e)}}),!0},defaultMessage:"Please entrer a proper value",async:!0}};for(var c in b){var d=b[c];ksv.rules.register(c,d)}}(ksv.utils)});